//
//  UserManager.m
//  YSProject
//
//  Created by cuiw on 15/6/8.
//  Copyright (c) 2015å¹´ cuiw. All rights reserved.
//

#import "UserManager.h"
#define kUserManager @"ysuarch"

@implementation UserManager

+ (UserManager *)shareUserManager {
    static UserManager *_userManager;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        _userManager  = [[UserManager alloc] init];
    });
    return _userManager;
}

- (id)init {
    self = [super init];
    if (self) {
        _user = [[UserModel alloc] init];
        _userState = UserStateLogout;
    }
    return self;
}

- (void)encodeWithCoder:(NSCoder *)enCoder {
    [enCoder encodeObject:_user forKey:@"UserManager_user"];
    [enCoder encodeObject:_sessionID forKey:@"UserManager_sessionID"];
    [enCoder encodeInteger:_userState forKey:@"UserManager_userState"];
}

- (id)initWithCoder:(NSCoder *)deCoder {
    if (self = [super init]) {
        self.user = [deCoder decodeObjectForKey:@"UserManager_user"];
        self.sessionID = [deCoder decodeObjectForKey:@"UserManager_sessionID"];
        self.userState = (UserState)[deCoder decodeIntegerForKey:@"UserManager_userState"];
    }
    return self;
}

+ (UserManager *)currentUserManager {
    UserManager *userManager = [[CWNSFileUtil sharedInstance] getCustomModelFromUserDefatulesWithKey:kUserManager];
    if (!userManager) {
        userManager = [UserManager shareUserManager];
        [[CWNSFileUtil sharedInstance] setCustomModelToUserDefaults:userManager withKey:kUserManager];
    }
    return userManager;
}
- (void)synchronize {
    [[CWNSFileUtil sharedInstance] setCustomModelToUserDefaults:self withKey:kUserManager];
}

+ (BOOL)isLogin {
    UserManager *userManager = [UserManager currentUserManager];
    if (userManager.userState == UserStateLogin) {
        return YES;
    } else {
        return NO;
    }
}
+ (void)logout {
    UserManager *userManager = [[CWNSFileUtil sharedInstance] getCustomModelFromUserDefatulesWithKey:kUserManager];
    userManager.user = [[UserModel alloc] init];
    userManager.userState = UserStateLogout;
    userManager.sessionID = nil;
    [[CWNSFileUtil sharedInstance] setCustomModelToUserDefaults:userManager withKey:kUserManager];
}

@end
